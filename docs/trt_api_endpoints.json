{
  "title": "TRT (Toncal) REST API Endpoints",
  "version": "1.0.1",
  "base_url": "http://localhost:8080",
  "authentication": {
    "type": "Bearer JWT",
    "description": "POST /dev/generate-token으로 토큰 생성 후 Authorization 헤더에 'Bearer <token>' 형식으로 전달"
  },
  "categories": {
    "development": {
      "name": "Development/Testing",
      "description": "개발 및 테스트용 엔드포인트 (프로덕션에서 비활성화 권장)",
      "endpoints": [
        {
          "method": "POST",
          "path": "/dev/generate-token",
          "description": "테스트용 JWT 토큰 생성",
          "auth_required": false,
          "request_body": {
            "user_id": "int (optional, 0이면 admin 사용)",
            "expires_hours": "int (optional, 기본값 24)"
          },
          "response": {
            "access_token": "string",
            "token_type": "bearer",
            "user": "object",
            "expires_in": "string"
          }
        },
        {
          "method": "GET",
          "path": "/dev/users",
          "description": "테스트용 사용자 목록 조회",
          "auth_required": false
        },
        {
          "method": "POST",
          "path": "/dev/setup-users-and-nodes",
          "description": "테스트용 유저(admin, user2) 및 네트워크 노드 생성",
          "auth_required": false
        },
        {
          "method": "POST",
          "path": "/dev/import-topology",
          "description": "scenario2_node_topology.json 형식의 토폴로지 임포트",
          "auth_required": false
        },
        {
          "method": "DELETE",
          "path": "/dev/clear-topology",
          "description": "모든 네트워크 노드와 엣지 삭제",
          "auth_required": false
        }
      ]
    },
    "operations": {
      "name": "Operations",
      "description": "Operation 관리 및 명령 실행",
      "endpoints": [
        {
          "method": "GET",
          "path": "/operations",
          "description": "사용자별 Operation 조회 (페이지네이션)",
          "auth_required": true,
          "query_params": {
            "skip": "int (기본값 0)",
            "limit": "int (기본값 100)"
          }
        },
        {
          "method": "POST",
          "path": "/operations",
          "description": "Operation 생성",
          "auth_required": true,
          "request_body": {
            "name": "string",
            "description": "string (optional)"
          }
        },
        {
          "method": "DELETE",
          "path": "/operations/{operation_id}",
          "description": "Operation 삭제",
          "auth_required": true
        },
        {
          "method": "POST",
          "path": "/operations/{operation_id}/commands/run",
          "description": "에이전트에 명령 실행 (paw 또는 depth 지정)",
          "auth_required": true,
          "notes": "operation_id가 '0'이면 오퍼레이션 없이 실행",
          "request_body": {
            "paw": "string (agent ID, optional)",
            "depth": "int (optional)",
            "executor": {
              "platform": "string (windows/linux)",
              "name": "string (command_prompt/powershell/bash/python)",
              "command": "string"
            }
          },
          "response": {
            "id": "string (command_link_id)",
            "status": "int (-1: pending)"
          }
        },
        {
          "method": "POST",
          "path": "/operations/{operation_id}/abilities/run",
          "description": "Ability(T-기법) 실행 (paw 또는 depth 지정)",
          "auth_required": true,
          "notes": "operation_id가 '0'이면 오퍼레이션 없이 실행",
          "request_body": {
            "paw": "string (agent ID, optional)",
            "depth": "int (optional)",
            "ability_id": "string (예: T1595.001)",
            "obfuscator": "string (예: plain)",
            "input": "object (예: {\"targetIp\": \"192.168.1.0/24\"})"
          }
        },
        {
          "method": "GET",
          "path": "/operations/orders/all",
          "description": "모든 공격 명령 조회 (관리자 전용, 페이지네이션)",
          "auth_required": true,
          "admin_only": true,
          "query_params": {
            "skip": "int (기본값 0)",
            "limit": "int (기본값 100)"
          }
        },
        {
          "method": "GET",
          "path": "/operations/orders/{order_id}",
          "description": "공격 명령 실행 상태 확인",
          "auth_required": true
        }
      ]
    },
    "abilities": {
      "name": "Abilities",
      "description": "MITRE ATT&CK Technique 관리",
      "endpoints": [
        {
          "method": "GET",
          "path": "/abilities/update-db",
          "description": "YAML 파일에서 Technique DB 업데이트 (관리자 전용)",
          "auth_required": true,
          "admin_only": true
        },
        {
          "method": "GET",
          "path": "/abilities",
          "description": "Ability 목록 조회 (페이지네이션)",
          "auth_required": true,
          "query_params": {
            "skip": "int (기본값 0)",
            "limit": "int (기본값 100)"
          }
        },
        {
          "method": "GET",
          "path": "/abilities/{ability_id}",
          "description": "특정 Ability 조회",
          "auth_required": true,
          "example": "/abilities/T1595.001@1"
        },
        {
          "method": "POST",
          "path": "/abilities/{ability_id}/set-default-input",
          "description": "Ability Input 기본값 변경 (사용자별)",
          "auth_required": true
        }
      ]
    },
    "adversaries": {
      "name": "Adversaries",
      "description": "공격 시나리오(Adversary) 관리",
      "endpoints": [
        {
          "method": "POST",
          "path": "/adversaries",
          "description": "Adversary 생성",
          "auth_required": true,
          "request_body": {
            "name": "string",
            "description": "string",
            "abilities": ["ability_id1", "ability_id2"]
          }
        },
        {
          "method": "GET",
          "path": "/adversaries",
          "description": "Adversary 목록 조회 (페이지네이션)",
          "auth_required": true,
          "query_params": {
            "skip": "int (기본값 0)",
            "limit": "int (기본값 100)"
          }
        },
        {
          "method": "GET",
          "path": "/adversaries/{adversary_id}",
          "description": "특정 Adversary 조회",
          "auth_required": true
        },
        {
          "method": "DELETE",
          "path": "/adversaries/{adversary_id}",
          "description": "Adversary 삭제",
          "auth_required": true
        },
        {
          "method": "POST",
          "path": "/adversaries/{adversary_id}/execute",
          "description": "Adversary 실행 (Depth 기반 AttackOrder 생성)",
          "auth_required": true,
          "response": {
            "status": "success",
            "adversary_id": "string",
            "total_orders_created": "int",
            "execution_method": "depth-based"
          }
        }
      ]
    },
    "agents": {
      "name": "Agents",
      "description": "Callisto Agent 관리",
      "endpoints": [
        {
          "method": "GET",
          "path": "/agents",
          "description": "사용자별 활성 Agent 조회 (10초 이내 비콘)",
          "auth_required": true,
          "response_example": [
            {
              "paw": "agent_unique_id",
              "host": "hostname",
              "platform": "windows",
              "server": "http://172.16.x.x",
              "contact": "HTTP"
            }
          ]
        },
        {
          "method": "GET",
          "path": "/agents/all",
          "description": "사용자별 모든 Agent 조회 (비활성 포함)",
          "auth_required": true
        }
      ]
    },
    "agent_download": {
      "name": "Agent Download",
      "description": "CallistoAgent 바이너리 다운로드 (Lateral Movement용)",
      "endpoints": [
        {
          "method": "GET",
          "path": "/agents/",
          "description": "사용 가능한 에이전트 파일 목록",
          "auth_required": false,
          "response_example": {
            "agent_directory": "/path/to/static/agents",
            "agents": {
              "windows": {
                "filename": "CallistoAgent.exe",
                "endpoint": "/agents/windows",
                "available": true
              },
              "linux": {
                "filename": "CallistoAgent.elf",
                "endpoint": "/agents/linux",
                "available": true
              }
            }
          }
        },
        {
          "method": "GET",
          "path": "/agents/windows",
          "description": "Windows용 CallistoAgent.exe 다운로드",
          "auth_required": false,
          "response": "application/octet-stream (binary file)"
        },
        {
          "method": "GET",
          "path": "/agents/linux",
          "description": "Linux용 CallistoAgent.elf 다운로드",
          "auth_required": false,
          "response": "application/octet-stream (binary file)"
        }
      ]
    },
    "results": {
      "name": "Results",
      "description": "명령 실행 결과 조회",
      "endpoints": [
        {
          "method": "POST",
          "path": "/results/query",
          "description": "Agent 또는 명령 결과 조회",
          "auth_required": true,
          "request_body": {
            "index": "string ('agents' 또는 'result')",
            "link_id": "string (index가 'result'일 때 필수)"
          },
          "response_example": [
            {
              "id": "command_link_id",
              "results": "nt authority\\system\n",
              "success": true,
              "log": "..."
            }
          ]
        }
      ]
    },
    "networknodes": {
      "name": "Network Topology",
      "description": "네트워크 노드 관리",
      "endpoints": [
        {
          "method": "GET",
          "path": "/networknodes",
          "description": "사용자별 NetworkNode 목록 조회",
          "auth_required": true
        },
        {
          "method": "POST",
          "path": "/networknodes",
          "description": "NetworkNode 생성",
          "auth_required": true,
          "request_body": {
            "ipAddress": "string",
            "hostname": "string",
            "role": "string",
            "os": "string (optional)",
            "platform": "string (optional)",
            "compromised": "boolean (optional)"
          }
        },
        {
          "method": "GET",
          "path": "/networknodes/{node_id}",
          "description": "특정 NetworkNode 조회",
          "auth_required": true
        },
        {
          "method": "PUT",
          "path": "/networknodes/{node_id}",
          "description": "NetworkNode 수정",
          "auth_required": true
        },
        {
          "method": "DELETE",
          "path": "/networknodes/{node_id}",
          "description": "NetworkNode 삭제",
          "auth_required": true
        },
        {
          "method": "POST",
          "path": "/networknodes/upsert",
          "description": "NetworkNode upsert (존재하면 업데이트, 없으면 생성)",
          "auth_required": true,
          "query_params": {
            "ip_address": "string"
          }
        },
        {
          "method": "GET",
          "path": "/networknodes/admin/all",
          "description": "모든 NetworkNode 조회 (관리자 전용)",
          "auth_required": true,
          "admin_only": true
        }
      ]
    },
    "users": {
      "name": "User Management",
      "description": "사용자 관리",
      "endpoints": [
        {
          "method": "GET",
          "path": "/users",
          "description": "내 정보 조회 (JWT 토큰 기반)",
          "auth_required": true
        },
        {
          "method": "GET",
          "path": "/users/all",
          "description": "모든 사용자 조회 (관리자 전용)",
          "auth_required": true,
          "admin_only": true
        },
        {
          "method": "GET",
          "path": "/users/{user_id}",
          "description": "특정 사용자 조회 (관리자 전용)",
          "auth_required": true,
          "admin_only": true
        }
      ]
    },
    "recommendations": {
      "name": "Adversary Recommendations",
      "description": "공격 시나리오 추천",
      "endpoints": [
        {
          "method": "GET",
          "path": "/recommendations/available",
          "description": "사용 가능한 Adversary 추천 목록 (토폴로지 호환)",
          "auth_required": true
        },
        {
          "method": "GET",
          "path": "/recommendations/chain/{filename}",
          "description": "특정 결과 파일의 상세 공격 체인 조회",
          "auth_required": true
        }
      ]
    },
    "agent_internal": {
      "name": "Agent Internal Communication",
      "description": "Callisto Agent 내부 통신 (Swagger에서 숨김)",
      "endpoints": [
        {
          "method": "POST",
          "path": "/result",
          "description": "Agent 실행 결과 수신 (Base64 인코딩)",
          "internal": true
        },
        {
          "method": "GET/POST",
          "path": "/beacon",
          "description": "Agent 비콘 수신 및 명령 전달 (Base64 인코딩)",
          "internal": true
        }
      ]
    }
  }
}
